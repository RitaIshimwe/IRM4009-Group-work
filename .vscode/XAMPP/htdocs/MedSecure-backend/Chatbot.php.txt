error_reporting(E_ALL);
ini_set('display_errors', 1);

<?php
header("Access-Control-Allow-Origin: *");
header("Content-Type: application/json");

// Database connection
$conn = new mysqli("localhost", "root", "", "Chatbot_db");

if ($conn->connect_error) {
    die(json_encode(["error" => "Database connection failed"]));
}

// Get user message from request
$data = json_decode(file_get_contents("php://input"), true);
$userMessage = strtolower(trim($data["message"]));

// Predefined responses
$responses = [
    "hello" => "Hello! How can I assist you today?",
    "book appointment" => "You can book an appointment on our website.",
    "policies" => "You can find our policies under the 'Policies' section.",
    "contact" => "You can contact us through the 'Contact Us' page.",
];

// Check if response exists, otherwise default
$botResponse = $responses[$userMessage] ?? "Sorry, I didn't understand that.";

// Save message to the database
$stmt = $conn->prepare("INSERT INTO messages (user_message, bot_response) VALUES (?, ?)");
$stmt->bind_param("ss", $userMessage, $botResponse);
$stmt->execute();
$stmt->close();

echo json_encode(["response" => $botResponse]);

$conn->close();
?>
